# swagger-gateway - Dev Environment
# Centralized Swagger/API Documentation Gateway with IAP protection
# Routes: swagger.dev.ourritual.com/<service-name> â†’ service's /swagger endpoint

# ğŸ–¼ï¸ Image Configuration
# Note: This is a gateway service, no application image needed
# We use a minimal nginx image just to have a pod running for the service
image:
  repository: nginx
  tag: alpine
  pullPolicy: IfNotPresent

# ğŸ“Š Scaling
replicaCount: 1

resources:
  requests:
    cpu: 10m
    memory: 16Mi
  limits:
    cpu: 50m
    memory: 64Mi

# ğŸ”„ Autoscaling - Disabled for gateway
autoscaling:
  enabled: false

# ğŸŒ Service
service:
  type: ClusterIP
  port: 80
  targetPort: 80

# ğŸš€ Ingress with IAP Protection
ingress:
  enabled: true
  className: gce
  annotations:
    # Use existing static IP
    kubernetes.io/ingress.global-static-ip-name: "swagger-dev-ip"
    # Enable IAP
    kubernetes.io/ingress.allow-http: "false"
    # Link to BackendConfig for IAP
    cloud.google.com/backend-config: '{"default": "swagger-gateway-backend-config"}'
    # Link to ManagedCertificate
    networking.gke.io/managed-certificates: swagger-gateway-cert
  hosts:
    - host: swagger.dev.ourritual.com
      paths:
        - path: /*
          pathType: ImplementationSpecific
  tls: []

# ğŸ”’ Backend Config for IAP
backendConfig:
  enabled: true
  iap:
    enabled: true
    oauthSecretName: swagger-iap-oauth
  healthCheck:
    checkIntervalSec: 30
    timeoutSec: 5
    healthyThreshold: 2
    unhealthyThreshold: 3
    type: HTTP
    requestPath: /
    port: 80
  sessionAffinity:
    affinityType: CLIENT_IP
    affinityCookieTtlSec: 3600
  timeoutSec: 30

# ğŸ« Managed Certificate
managedCertificate:
  enabled: true
  domains:
    - swagger.dev.ourritual.com

# ğŸŒ Environment Variables
env:
  - name: NGINX_PORT
    value: "80"

# ğŸ¥ Health Probes
livenessProbe:
  httpGet:
    path: /
    port: 80
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /
    port: 80
  initialDelaySeconds: 5
  periodSeconds: 5

# ğŸ“ Annotations
annotations:
  description: "Centralized Swagger gateway with IAP protection"

# ğŸ·ï¸ Labels
labels:
  app: swagger-gateway
  tier: infrastructure
  component: api-docs

# External Secrets - Not needed for this infrastructure service
externalSecrets:
  enabled: false

# Gateway API - Disabled, using Ingress instead
gateway:
  enabled: false

